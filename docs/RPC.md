# RPC 協議

Mego 採用類似 [JSON-RPC](http://www.jsonrpc.org/specification) 的格式，但由於 [JSON-RPC](http://www.jsonrpc.org/specification) 是設計給單向性溝通而非雙向性溝通，因此 Mego 在此有做異動。

## 請求物件

請求物件是來自客戶端的資料，其格式必須遵守如下。

* method
    必要字串欄位。此欄位表明該呼叫遠端伺服器的哪個函式。

* params
    可選陣列、物件欄位。此欄位是陣列時則當作呼叫函式時所傳入的參數；若是物件則為資料結構可在伺服端映射。當此欄位為空時則作為無資料事件請求。

* files
    可選檔案物件欄位。用以上傳至伺服端的檔案欄位。

* id
    可選數字欄位。此欄位讓伺服器得知結果應該對應哪個請求；當此欄位為空時則作為不求返回的事件請求。此欄位須於客戶端自動遞增。

### 事件

沒有 `id` 的請求即為一個事件，這將會單向地發送一個請求到伺服器作為通知而非請求。一個事件可以省略 `params` 欄位。

## 回應物件

回應物件是來自伺服器並傳送至客戶端的資料，其格式必須遵守如下。

* event
    在廣播事件下必要的字串欄位。此為事件名稱。

* result
    在成功狀態下的必要陣列、物件欄位。錯誤發生時不可帶有此欄位。

* error
    在錯誤狀態下的必要錯誤物件欄位。正常成功狀況時不可帶有此欄位。

* id
    必要數字欄位。用以呼應指定請求的校對欄位。這必須和發送請求物件中的 `id` 相符。

### 錯誤

一個標準的錯誤物件，其格式必須遵守如下。

* code
    必要數字欄位。此欄位作為錯誤狀態碼使用，可使用 Mego 標準狀態碼或是使用者自訂。

* message
    必要字串欄位。作為可供人類解讀的大略錯誤解釋訊息。

* data
    可選陣列、物件欄位。此欄位為錯誤的詳細資料。

## 檔案物件

* bin
    必要二進制欄位。此欄位帶有片段、區塊的二進制內容。將會在伺服器上進行組合。

* id
    必要數字欄位。由客戶端替每個檔案產生。用以讓伺服端辨識二進制片段的對應檔案物件為何。

* name
    必要字串欄位。此欄位表示檔案原本的名稱與其副檔名。

* last
    必要布林值欄位。此欄位表示此片段是否為本檔案的最後一個區塊。


* 阻止沒有 Mego 握手的所有請求